___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "displayName": "Partnerize Standard eCommerce Tag",
  "categories": [
    "AFFILIATE_MARKETING",
    "ADVERTISING",
    "CONVERSIONS",
    "MARKETING",
    "SALES"
  ],
  "description": "This is the standard eCommerce tracking tag for Partnerize. This is used to send your purchase marketing events to Partnerize. This relates to the Google Analytics commerce tag.",
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHMAAABzCAYAAACrQz3mAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QTVDMDRCMDQ2Q0M1MTFFOEFFNzZGQ0UwNEFGNUI1NTUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTVDMDRCMDM2Q0M1MTFFOEFFNzZGQ0UwNEFGNUI1NTUiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxNDk3QUJBMzU3MkMxMUU4QkQzMUMzREQyQjM1RTcwQyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxNDk3QUJBNDU3MkMxMUU4QkQzMUMzREQyQjM1RTcwQyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PicAukUAABe5SURBVHja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",
    "displayName": "webmasterjunkie",
    "id": "github.com_webmasterjunkie"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "help": "This value would be provided to you by your Partnerize integration engineer.",
    "displayName": "Campaign ID",
    "simpleValueType": true,
    "name": "CampaignID",
    "type": "TEXT",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "alwaysInSummary": true
  },
  {
    "type": "LABEL",
    "name": "ParamDetails",
    "displayName": "These \"Custom Tag Values\" are what are Partnerize \"meta parameters\". The default tag will already capture items like \"conversionref\", \"category\", and \"value(s)\"."
  },
  {
    "help": "You can provide as many custom parameters to the conversion level of this event as you would like.",
    "displayName": "Custom Tag Values",
    "name": "CustomValues",
    "simpleTableColumns": [
      {
        "valueValidators": [],
        "defaultValue": "",
        "displayName": "Parameter Name",
        "name": "customParameters",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "Parameter Value",
        "name": "customValues",
        "type": "TEXT"
      }
    ],
    "type": "SIMPLE_TABLE"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Include the required APIs
const log = require('logToConsole');
const sendPixel = require('sendPixel');
const encodeUriComponent = require('encodeUriComponent');
const copyFromDataLayer = require('copyFromDataLayer');
const localStorage = require('localStorage');
const queryPermission = require('queryPermission');

const transactionId = copyFromDataLayer('transactionId');
const transactionProducts = copyFromDataLayer('transactionProducts');
const localStorageID = 'partnerizeClickReference';

// Begin setup of the tracking pixel
var url = 'https://prf.hn/conversion/campaign:' + encodeUriComponent(data.CampaignID) + '/';

// Add the clickref if present
let clickref = localStorage.getItem(localStorageID);
if (clickref != '' && clickref != null){
  url = url + 'clickref:' + clickref + '/';
}

// Add the order id to the pixel
if (typeof transactionId != 'undefined'){
  url = url + 'conversionref:' + encodeUriComponent(transactionId) + '/';
}

// Add the custom basket level tracking parameters
if (typeof data.CustomValues != 'undefined'){
  data.CustomValues.forEach(function(element) {
	  if (typeof element.customValues !== 'undefined'){
		  url = url + formatParameter(element.customParameters) + ':' + encodeUriComponent(element.customValues) + '/';
	  } else {
		  url = url + formatParameter(element.customParameters) + ':/';
	  }
  });
}

// Add the item level values
if (typeof transactionProducts != 'undefined'){
	url = url + createItemString(transactionProducts);
}

// Call data.gtmOnSuccess when the tag is finished.
sendPixel(url, data.gtmOnSuccess, data.gtmOnFailure);

// Enable logging for debugging purposes
log(url);
log(data);

/*
Remove any characters that could cause issues with the Partnerize parameter
customParameters 	string 	The value from the data object
return 				string	The value that is cleaned as a parameter name
*/
function formatParameter(customParameters){
  var string = customParameters.replace(' ', '_');
  var regex = "/[^A-Za-z0-9_]/";

  return string.replace(regex, '', string).toLowerCase();
}

/*
Convert the products array into the required format for Partnerize
ecomProducts	object/array	The dataLayer object
return			string			The Partnerize string of product items
*/
function createItemString(ecomProducts){
  var stringproducts = '';

  for (var i = 0; i < ecomProducts.length; i++){
	stringproducts = stringproducts + '[';
	for (var key in ecomProducts[i]){
      switch (key){
        case "currency": break;

        case "price":
		  // Enable logging for debugging purposes
          log('value: ' + encodeUriComponent(ecomProducts[i][key].toString()));
          stringproducts = stringproducts + 'value:' + encodeUriComponent(ecomProducts[i][key].toString()) + '/';
          break;

        default:
		  // Enable logging for debugging purposes
          if (typeof ecomProducts[i][key] !== 'undefined' && ecomProducts[i][key] !== null) {
            log(key + ': ' + encodeUriComponent(ecomProducts[i][key].toString()));
            stringproducts = stringproducts + key + ':' + encodeUriComponent(ecomProducts[i][key].toString()) + '/';
          } else {
            log(key + ': null');
            stringproducts = stringproducts + key + ':/';
          }
          break;
      }
	}

	stringproducts = stringproducts + ']';
  }

  return stringproducts;
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://prf.hn/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "transactionId"
              },
              {
                "type": 1,
                "string": "transactionProducts.*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_local_storage",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "partnerizeClickReference"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 25/10/2019, 10:49:37